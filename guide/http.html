
<!DOCTYPE html>
<html lang="pt">
  <head>
    <title>HTTP - Stellar</title>

    <!-- charset -->
    <meta charset="utf-8">

    <!-- description -->
    <meta name="description" content="Stellar is an action based web framework for creating Web APIs easily!">

    <!-- viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <!-- fonts -->
    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,600|Roboto Mono' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Dosis:300,500' rel='stylesheet' type='text/css'>

    <!-- page type -->
    <script>
      window.PAGE_TYPE = 'guide'
    </script>

    <!-- load page style -->
    <link rel="stylesheet" href="/css/page.css">

    <!-- load Google Analytics -->
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-77611901-1', 'auto');
  ga('send', 'pageview');
</script>

  </head>
  <body>
    <div id="mobile-bar">
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>

    
      <div id="header">
    <a id="logo" href="/">
        <img src="/images/logo.png">
        <span>Stellar</span>
    </a>
    <ul id="nav">
        <li><a href="/guide/" class="nav-link current">Guia</a></li>
<li><a href="/blog/" class="nav-link">Blog</a></li>

    </ul>
</div>

      <div id="main">
        
          
  <div class="sidebar">
  <ul class="main-menu">
    <li><a href="/guide/" class="nav-link current">Guia</a></li>
<li><a href="/blog/" class="nav-link">Blog</a></li>

  </ul>
  <div class="list">
    <ul class="menu-root">
      
        <li>
          <a href="/guide/index.html" class="sidebar-link">Visão Geral</a>
        </li>
      
        <li>
          <a href="/guide/installation.html" class="sidebar-link">Instalação</a>
        </li>
      
        <li>
          <a href="/guide/actions.html" class="sidebar-link">Ações</a>
        </li>
      
        <li>
          <a href="/guide/tasks.html" class="sidebar-link">Tarefas</a>
        </li>
      
        <li>
          <a href="/guide/middleware.html" class="sidebar-link">Middleware</a>
        </li>
      
        <li>
          <a href="/guide/satellites.html" class="sidebar-link">Satélites</a>
        </li>
      
        <li>
          <a href="/guide/cluster.html" class="sidebar-link">Cluster</a>
        </li>
      
        <li>
          <a href="/guide/cache.html" class="sidebar-link">Cache</a>
        </li>
      
        <li>
          <a href="/guide/chat.html" class="sidebar-link">Chat</a>
        </li>
      
        <li>
          <a href="/guide/development_mode.html" class="sidebar-link">Modo de Desenvolvimento</a>
        </li>
      
        <li>
          <a href="/guide/file_system.html" class="sidebar-link">Sistema de Ficheiros</a>
        </li>
      
        <li>
          <a href="/guide/logging.html" class="sidebar-link">Logging</a>
        </li>
      
        <li>
          <a href="/guide/events.html" class="sidebar-link">Eventos</a>
        </li>
      
        <li>
          <a href="/guide/websocket.html" class="sidebar-link">WebSocket</a>
        </li>
      
        <li>
          <a href="/guide/tcp.html" class="sidebar-link">TCP</a>
        </li>
      
        <li>
          <a href="/guide/http.html" class="sidebar-link current">HTTP</a>
        </li>
      
        <li>
          <a href="/guide/security.html" class="sidebar-link">Segurança</a>
        </li>
      
    </ul>
  </div>
</div>



<div class="content guide with-sidebar">
  <h1>HTTP</h1>
  <h2 id="Introducao"><a href="#Introducao" class="headerlink" title="Introdução"></a>Introdução</h2><p>O servidor HTTP permite executar <a href="./actions.html">ações</a> e expor ficheiros sob o protocolo HTTP e HTTPS. A API pode ser acedida através de um browser, pelo comando Curl, etc. Através do endereço <code>&lt;url&gt;?action=&lt;nome_da_ação&gt;</code> ou <code>&lt;url&gt;/api/&lt;nome_da_ação&gt;</code> é onde pode aceder às ações. Por exemplo, se quiser aceder à ação ‘getPosts’ num servidor local que está à escuta na porta 8080, teria que fazer uma chamada para o URL <code>http://127.0.0.1/?action=getPosts</code>.</p>
<p>O código JSON abaixo mostra uma exemplo de uma resposta do servidor.</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"questions"</span>: [ ],</span><br><span class="line">  <span class="attr">"serverInformation"</span>: &#123;</span><br><span class="line">    <span class="attr">"serverName"</span>: <span class="string">"Stellar API"</span>,</span><br><span class="line">    <span class="attr">"apiVersion"</span>: <span class="string">"0.0.1"</span>,</span><br><span class="line">    <span class="attr">"requestDuration"</span>: <span class="number">194</span>,</span><br><span class="line">    <span class="attr">"currentTime"</span>: <span class="number">1471702323600</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"requesterInformation"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="string">"6f9e36f49e49dd7ac30348a0d9826e367ac747d7-cec5fb6e-2b0b-416e-8529-f897ea666d39"</span>,</span><br><span class="line">    <span class="attr">"fingerprint"</span>: <span class="string">"6f9e36f49e49dd7ac30348a0d9826e367ac747d7"</span>,</span><br><span class="line">    <span class="attr">"remoteIP"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">    <span class="attr">"receivedParams"</span>: &#123;</span><br><span class="line">      <span class="attr">"action"</span>: <span class="string">"getQuestions"</span>,</span><br><span class="line">      <span class="attr">"apiVersion"</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Enviar-Ficheiros"><a href="#Enviar-Ficheiros" class="headerlink" title="Enviar Ficheiros"></a>Enviar Ficheiros</h2><p>Stellar também pode servir ficheiros ao cliente. O Stellar não faz fazer <em>cache</em> dos ficheiros, a cada pedido eles são lidos do disco. A seguir encontra-se um exemplo de como servir um ficheiro ao cliente a partir de uma ação.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// especifica o ficheiro a enviar para o cliente</span></span><br><span class="line">action.connection.sendFile(<span class="string">'/path/to/file.txt'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// informa que não é para fazer o render da resposta</span></span><br><span class="line">action.toRender = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// termina a execução da ação</span></span><br><span class="line">next()</span><br></pre></td></tr></table></figure>
<ul>
<li><p>A raiz do servidor <em>web</em> <code>/</code> pode ser usada para servir ficheiros (<code>/files</code>) ou ações (<code>/api</code>). O seu comportamento pode ser alterado na configuração <code>api.config.servers.web.rootEndpointType</code>, por defeito serve ficheiros.</p>
</li>
<li><p>Quando um ficheiro não é encontrado o resultado é uma página com o erro HTTP 404.</p>
</li>
<li><p>Sempre que possível será recorrido ao pacote <a href="https://www.npmjs.com/package/mime" target="_blank" rel="external">mime</a> para adicionar uma entrada no cabeçalho da resposta com o <code>mime-type</code> do ficheiro servido.</p>
</li>
</ul>
<blockquote>
<p>Nota: Na secção <a href="./file_system.html">“Sistema de Ficheiros”</a> podem ser encontrado alguns <em>helpers</em> que ajudam no envio de ficheiros.</p>
</blockquote>
<h2 id="Rotas"><a href="#Rotas" class="headerlink" title="Rotas"></a>Rotas</h2><p>Para os cliente <em>web</em> (HTTP e HTTPS), é possível, opcionalmente, definir rotas RESTful para as ações. Se o cliente não especificar a ação via parâmetro e se o URL não se tratar de uma <em>named action</em>, o servidor irá tentar encontrar uma rota definida nos ficheiros <code>routes.json</code> que podem existir na raiz de cada módulo.</p>
<p>Existem três formas dos clientes aceder a ações via servidor <em>web</em>:</p>
<ul>
<li><p>sem nenhuma rota, recorrendo a parâmetros GET: <code>example.com/api?action=getPosts</code></p>
</li>
<li><p>através de <em>basic routing</em>, onde o nome das ações irão responder depois do caminho <code>/api</code>, por exemplo: <code>example.com/api/getPosts</code></p>
</li>
<li><p>ou através de rotas definidas pelos desenvolvedores, por exemplo, é possível servir uma ação com a seguinte rota <code>example.com/api/posts</code></p>
</li>
</ul>
<p>Se a configuração <code>api.config.servers.web.rootEndpointType</code> tiver o valor <code>&#39;file&#39;</code> isso quer dizer que as rotas irão responder sobre o prefixo <code>/api</code>. Para o servidor responder à rota <code>example.com/posts</code>, o <code>api.config.servers.web.rootEndpointType</code> deve estar definido como <code>&#39;api&#39;</code>.</p>
<blockquote>
<p>Nota: Ao alterar a configuração de <code>&#39;file&#39;</code> para <code>&#39;api&#39;</code> as rotas em <code>/api</code> continuam a funcionar.</p>
</blockquote>
<p>O JSON abaixo mostra um exemplo da declaração de rotas:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"all"</span>: [</span><br><span class="line">    &#123; <span class="attr">"path"</span>: <span class="string">"/cache/:key/:value"</span>, <span class="attr">"action"</span>: <span class="string">"setCache"</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"get"</span>: [</span><br><span class="line">    &#123; <span class="attr">"path"</span>: <span class="string">"/question"</span>,      <span class="attr">"action"</span>: <span class="string">"getQuestions"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">"path"</span>: <span class="string">"/question/:id"</span>,  <span class="attr">"action"</span>: <span class="string">"getQuestion"</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"post"</span>: [</span><br><span class="line">    &#123; <span class="attr">"path"</span>: <span class="string">"/question"</span>, <span class="attr">"action"</span>: <span class="string">"createQuestion"</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"put"</span>: [</span><br><span class="line">    &#123; <span class="attr">"path"</span>: <span class="string">"/question/:id"</span>, <span class="attr">"action"</span>: <span class="string">"editQuestion"</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"delete"</span>: [</span><br><span class="line">    &#123; <span class="attr">"path"</span>: <span class="string">"/question/:id"</span>, <span class="attr">"action"</span>: <span class="string">"removeQuestion"</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Usar-Versoes"><a href="#Usar-Versoes" class="headerlink" title="Usar Versões"></a>Usar Versões</h3><p>Também é possível especificar a versão da ação a associar à rota, por defeito é executada a ultimação versão da ação. O exemplo abaixo mostra essa funcionalidade:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"all"</span>: [</span><br><span class="line">    &#123; <span class="attr">"path"</span>: <span class="string">"/actionName/old"</span>, <span class="attr">"action"</span>: <span class="string">"actionName"</span>, <span class="attr">"apiVersion"</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">"path"</span>: <span class="string">"/actionName/new"</span>, <span class="attr">"action"</span>: <span class="string">"actionName"</span>, <span class="attr">"apiVersion"</span>: <span class="number">2</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Desativar-os-Acessos-em-api"><a href="#Desativar-os-Acessos-em-api" class="headerlink" title="Desativar os Acessos em /api"></a>Desativar os Acessos em /api</h3><p>Para desativas os acessos em <code>/api</code> e apenas seja possível aceder à ações através da raiz do servidor, apenas é necessário alterar o valor de <code>api.config.servers.web.urlPathForActions</code> para <code>null</code>.</p>
<blockquote>
<p>Nota: A parâmetro <code>api.config.servers.web.rootEndpointType</code> deve ser igual a <code>&#39;api&#39;</code>, caso contrario não será possível fazer chamadas às ações.</p>
</blockquote>
<h2 id="Parametros"><a href="#Parametros" class="headerlink" title="Parâmetros"></a>Parâmetros</h2><p>Os parâmetros podem ser especificados através de parâmetros GET ou por POST. A ordem de carregamento dos parâmetros é: GET -&gt; POST (normal) -&gt; POST (multipart). Isto quer dizer que se for feito uma chamada ao URL <code>example.com/?key=getValue</code> e no post estiver uma variável definida <code>key=postValue</code>, o <code>postValue</code> será o valor usado.</p>
<p>Os ficheiros para <em>upload</em> carregados através de um formulário também irão aparecer no objeto <code>connection.params</code>, mas será uma objeto com mais informação. Isto é, se for carregado um ficheiro chamado <code>&#39;image&#39;</code>, o objeto <code>connection.params.image</code> irá existir com as informações: <code>name</code> (nome original do ficheiro), <code>path</code> (caminho para o ficheiro), <code>type</code> (tipo do ficheiro).</p>
<h2 id="Upload-de-Ficheiros"><a href="#Upload-de-Ficheiros" class="headerlink" title="Upload de Ficheiros"></a>Upload de Ficheiros</h2><p>O Stellar usa a biblioteca <a href="https://www.npmjs.com/package/formidable" target="_blank" rel="external">formidable</a> para fazer o <em>parse</em> dos parâmetros da chamada dos clientes. É possível fazer o <em>uplaod</em> de múltiplos ficheiros que irão estar disponíveis no objeto <code>connection.params</code>, como referências para um objeto <strong>formidable</strong>, que contem o nome original do ficheiro, a localização onde o ficheiro foi temporariamente guardado, etc.</p>
<h2 id="Biblioteca-do-Cliente"><a href="#Biblioteca-do-Cliente" class="headerlink" title="Biblioteca do Cliente"></a>Biblioteca do Cliente</h2><p>Por fim, o StellarClient é uma biblioteca <em>client-side</em>, maioritariamente em WebSockets, que permite interagir de forma simples com o servidor Stellar. Antes do método <code>connect</code> ser executado ou quando a ligação através de WebSocket é quebrada, é usada uma ligação HTTP.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// cria um novo cliente</span></span><br><span class="line"><span class="keyword">let</span> stellar = <span class="keyword">new</span> StellarClient(&#123; url: <span class="string">'server.example.com:8080'</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// executa uma ação</span></span><br><span class="line">stellar.action(<span class="string">'createPost'</span>, &#123; title: <span class="string">'Example!'</span>, content: <span class="string">'Some content...'</span> &#125;, error, resposta =&gt; &#123;</span><br><span class="line">  <span class="comment">// faz alguma coisa...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Nota: Uma vez que não foi chamado o método <code>connect</code> a chamada à ação é feita através de HTTP. Mais informação nos <em>docs</em> do <a href="./websocket.html">WebSocket</a>.</p>
</blockquote>


  
      <div class="guide-links">
        
          <span>← <a href="/guide/tcp.html">TCP</a></span>
        
        
          <span style="float:right"><a href="/guide/security.html">Segurança</a> →</span>
        
      </div>
    

    <div class="footer">
      Encontrou um erro ou quer contribuir para a documentação?
      <a href="https://github.com/gil0mendes/pt.stellar-framework.com/tree/master/src/guide/http.md" target="_blank">
        Edite esta página no Github!
      </a>
    </div>
</div>

        
      </div>

      <script src="/js/smooth-scroll.min.js"></script>
      <script src="/js/common.js"></script>
    

    <!-- enable FastClick  -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        FastClick.attach(document.body)
      }, false)
    </script>
  </body>
</html>
